# Release Notes: v0.2.8

**Date**: 2025-11-07

Documentation and process improvement release establishing the CDRL (Clone â†’ Degit â†’ Refit â†’ Launch) template standard system and fixing exit codes snapshot staleness. This release provides comprehensive guidance for template customization workflows, adds three forge template categories to the taxonomy, and enhances the build pipeline to prevent YAML/JSON drift.

## Highlights

- **CDRL Template Standard System**: Complete documentation framework for template customization (10,500+ words)
- **Exit Codes Process Fix**: Two-stage sync pipeline prevents snapshot staleness
- **Forge Template Categories**: Three new taxonomy categories with CDRL requirements
- **Required Documentation Outline**: Canonical structure for template CDRL guides
- **Makefile Standard Annex B**: Template validation targets specification

## What's New

### 1. CDRL Template Standard System

Comprehensive documentation and validation framework for predictable, repeatable template customization across all Fulmen forge templates.

**CDRL Workflow**: Clone â†’ Degit â†’ Refit â†’ Launch

**Core Documents Created**:

#### Architectural Standard (`docs/architecture/fulmen-template-cdrl-standard.md`)

Complete compliance requirements for forge templates (5,700+ words):

- **CDRL Workflow Definition**: Four-stage process (Clone, Degit, Refit, Launch) with characteristics (fast <10 min, safe, predictable, repeatable)
- **Required Template Capabilities**:
  1. App Identity Module (`.fulmen/app.yaml`) as single source of truth for customization
  2. Parameterization points (binary name, env vars, config paths, telemetry namespaces)
  3. Validation targets (`make validate-app-identity`, `make doctor`)
  4. Standard directory structure with CDRL-ready files
- **Quality Gates**: Pre-release validation checklist and example refit testing procedures
- **Forge-Specific Variations**: Customization differences between workhorse and codex templates
- **Anti-Patterns**: Documentation of what NOT to do (hardcoded identifiers, manual find-replace, no validation)

#### Workflow Guide (`docs/standards/cdrl/workflow-guide.md`)

User-facing step-by-step instructions (4,800+ words):

- **Complete 4-Stage Workflow**: Detailed commands and expected outputs for each stage
- **Refit Substeps**: 8 detailed substeps from App Identity update through final validation
- **Parameterization Reference**: Tables listing all customization points with before/after examples
- **Verification Checklist**: Complete task list for validating successful refit
- **Common Customization Patterns**: Examples for web API, worker, CLI tool, documentation site
- **Troubleshooting Guide**: Solutions for App Identity loading, env vars, config paths, validation failures
- **Template-Specific Guidance**: How to adapt workflow for different forge types

#### Required Documentation Outline

Canonical structure for `fulmen_cdrl_guide.md` that ALL templates must follow:

```markdown
# [Template Name] CDRL Guide

## Overview

## Prerequisites

## CDRL Workflow

### Step 1: Clone

### Step 2: Degit

### Step 3: Refit (8 substeps)

### Step 4: Launch

## Parameterization Reference

## Verification Checklist

## Common Customization Patterns (RECOMMENDED)

## Troubleshooting (RECOMMENDED)

## Next Steps (RECOMMENDED)
```

**Template Documentation Structure**:

Templates MUST provide:

- `docs/development/fulmen_cdrl_guide.md` (REQUIRED - pure CDRL workflow)

Templates MAY provide:

- `docs/development/README.md` (RECOMMENDED - development overview)
- `docs/development/tooling-guide.md` (OPTIONAL - goneat, hooks, DX choices)
- `docs/development/customization-advanced.md` (OPTIONAL - post-refit patterns)
- `docs/development/distribution-options.md` (OPTIONAL - packaging, deployment)

**Purpose**: Separation of concerns - CDRL guide focuses ONLY on refit workflow, supplementary guides handle template-specific tooling and advanced topics.

#### Reference Bootstrap Pattern (`docs/standards/cdrl/reference-bootstrap.md`)

Complete implementation guidance for reproducible development environment setup (18,000+ words):

**Problem**: Templates need development tools (goneat, etc.) but system-wide installation causes version drift and "works on my machine" issues.

**Solution**: Manifest-driven local bootstrap pattern with version pinning and checksum verification.

**Key Components**:

1. **Manifest Schema** (`.goneat/tools.yaml`):
   - Tool definitions with download URLs, checksums, platform substitutions
   - Example: goneat v0.3.3 with SHA256 checksums for darwin/linux arm64/amd64
   - Local dev override support (`.goneat/tools.local.yaml`)

2. **Canonical Implementations**:
   - **Python**: [percheron/scripts/bootstrap.py](https://github.com/fulmenhq/forge-workhorse-percheron/blob/main/scripts/bootstrap.py) (canonical)
   - **TypeScript**: aurora/scripts/bootstrap.ts (TBD - will be canonical for codex templates)
   - **Go**: Native Go dependency management via `go.mod` (no bootstrap needed)

3. **Features**:
   - Platform detection (darwin, linux, windows Ã— amd64, arm64)
   - Archive extraction (tar.gz, zip)
   - SHA256 checksum verification for security
   - Executable permissions handling
   - HTTPS-only downloads

4. **Template Maintainer Guidance**:
   - Step-by-step adaptation instructions
   - Makefile integration (`make bootstrap`, `make bootstrap-force`)
   - `.gitignore` requirements (`/bin/`, `/.goneat/tools.local.yaml`)
   - CI/CD integration examples

5. **Integration Points**:
   - CDRL Launch stage (Step 4.1: Bootstrap Dependencies)
   - Optional `tooling-guide.md` documentation
   - Forge standard compliance (RECOMMENDED for Python/TypeScript templates)

**Security Requirements**:

- MUST verify SHA256 checksums for all downloads
- MUST use HTTPS URLs only
- MUST set proper executable permissions (0o755)

**Testing Checklist**:

- Bootstrap completes on clean clone
- Correct binary version installed
- All platforms pass checksum verification
- CI/CD environment matches local development

---

### 2. Exit Codes Snapshot Staleness Fix

**Problem**: YAML catalog enhancements not propagating to JSON snapshots, causing helper library test failures.

**Root Cause**: Two separate scripts with no dependency:

- `scripts/generate-exit-code-snapshots.ts` - Generates JSON from YAML
- `scripts/codegen/generate-exit-codes.ts` - Generates language bindings from JSON

**Impact**: Signal handling semantics added in v0.2.5 (`exit-codes.yaml` updated) but snapshots not regenerated, causing description mismatches:

- Expected: `"Hangup signal (SIGHUP) - config reload via restart"`
- Actual: `"Hangup signal (SIGHUP)"`

**Solution**: Two-stage sync pipeline

**Stage 1 - Snapshot Generation**:

```bash
make generate-snapshots  # New standalone target
# Runs: bun run scripts/generate-exit-code-snapshots.ts
# Regenerates: config/library/foundry/exit-codes.snapshot.json
```

**Stage 2 - Code Generation & Sync**:

```bash
make sync  # Now includes Stage 1 automatically
# 1. Generate snapshots from YAML catalogs (Stage 1)
# 2. Generate language bindings from fresh snapshots
#    - foundry/exit_codes.go
#    - lang/python/src/crucible/foundry/exit_codes.py
#    - lang/typescript/src/foundry/exitCodes.ts
# 3. Sync schemas/docs/config to language wrappers
```

**Benefits**:

- âœ… Prevents future YAML/snapshot drift
- âœ… Automated in standard workflow (`make sync` before commits)
- âœ… Standalone target for manual invocation
- âœ… Clear build pipeline documentation

**Files Changed**:

- `scripts/sync-to-lang.ts` - Added `generateSnapshots()` function before codegen
- `Makefile` - Added `generate-snapshots` target
- `docs/architecture/sync-model.md` - Documented two-stage pipeline
- `config/library/foundry/exit-codes.snapshot.json` - Regenerated with correct descriptions

---

### 3. Forge Template Categories

Three new repository categories added to `config/taxonomy/repository-categories.yaml`:

#### `forge-workhorse`

**Summary**: Production-ready templates for backend services (Clone â†’ Degit â†’ Refit â†’ Launch)

**Primary Entry Points**:

- Template repository (GitHub)
- CDRL workflow (Clone â†’ Degit â†’ Refit â†’ Launch)
- `make validate-app-identity`
- `make doctor`

**Examples**: groningen (Go), percheron (Python)

**Required**:

- `.fulmen/app.yaml` (App Identity)
- CDRL validation targets
- `docs/development/fulmen_cdrl_guide.md`

**References**:

- Workhorse standard
- CDRL standard
- CDRL workflow guide
- Makefile standard Annex B

#### `forge-codex`

**Summary**: Production-ready templates for documentation sites (Clone â†’ Degit â†’ Refit â†’ Launch)

**Primary Entry Points**:

- Template repository (GitHub)
- CDRL workflow
- `make validate-app-identity`
- `make doctor`

**Examples**: aurora (Astro/Starlight)

**Required**:

- `.fulmen/app.yaml`
- CDRL validation targets
- `docs/development/fulmen_cdrl_guide.md`
- Astro/Starlight baseline

**References**:

- Codex standard
- CDRL standard
- CDRL workflow guide
- Makefile standard Annex B

#### `forge-gymnasium`

**Summary**: Experimental templates for prototyping and research

**CDRL Compliance**: RECOMMENDED but not required until graduation to forge-workhorse or forge-codex

**Purpose**: Allow experimentation without CDRL overhead, graduate to production forge when stable

---

### 4. Makefile Standard Annex B

New section added to `docs/standards/makefile-standard.md` specifying CDRL validation targets for template repositories.

**Required Targets**:

#### `make validate-app-identity`

**Purpose**: Detect hardcoded breed/site names in source code

**Exit Codes**:

- `0`: No hardcoded references found (clean)
- `1`: Violations detected (blocking)

**Implementation Requirements**:

- Scan source files for breed name (e.g., `groningen`, `percheron`)
- Exclude `.fulmen/app.yaml`, documentation, READMEs
- Report violating files with line numbers
- Language-specific directory scanning (Go: `cmd/`, `internal/`; Python: `src/`, `tests/`; TypeScript: `src/`, `lib/`)

**Example Output** (failure):

```
âŒ Found hardcoded 'groningen' references (see above)
src/internal/cmd/root.go:45
config/groningen.yaml
```

#### `make doctor` (or `make validate-cdrl-ready`)

**Purpose**: Comprehensive CDRL refit completeness check

**Exit Codes**:

- `0`: All checks passed, CDRL refit complete
- `1`: Warnings detected (non-blocking)
- `2`: Errors detected (blocking)

**Implementation Requirements**:

1. App Identity validation (file exists, YAML valid, required fields present)
2. Environment variable prefix consistency
3. Configuration path validation
4. Module path updated (language-specific)
5. Test suite passes (`make test`)

**Example Output** (success):

```
ðŸ¥ Running CDRL completeness check...
âœ… App Identity: Valid (.fulmen/app.yaml)
âœ… Environment Variables: Consistent prefix (MYAPI_)
âœ… Configuration Paths: Match identity (config_name: myapi)
âœ… Module Path: Updated (github.com/mycompany/myapi)
âœ… Tests: Passing (10 tests, 0 failures)
ðŸŽ‰ CDRL refit complete - ready to launch!
```

**CI Integration**:

```yaml
- name: Validate CDRL Readiness
  run: |
    make validate-app-identity
    make doctor
```

---

### 5. Forge Standards Updates

Both `docs/architecture/fulmen-forge-workhorse-standard.md` and `docs/architecture/fulmen-forge-codex-standard.md` now include comprehensive "CDRL Compliance" sections:

**Required CDRL Implementation**:

1. App Identity Module (primary customization point)
2. CDRL Validation Targets (Makefile targets with proper help output)
3. CDRL Workflow Guide (template-specific `fulmen_cdrl_guide.md`)
4. Directory Structure CDRL Readiness (`.fulmen/app.yaml`, `.env.example`, config files)

**CDRL Parameterization Points** (documented per template):

- **Workhorse**: Binary name, module path, env vars, config paths, telemetry namespaces
- **Codex**: Site name, canonical URL, analytics IDs, branding assets, content paths

**Validation Requirements**:

```bash
# Pre-release gate
make validate-app-identity  # Exit 0: No hardcoded breed names
make doctor                 # Exit 0: Comprehensive validation passed
make test                   # Exit 0: All tests pass
```

**Example Refit Test** (required for template maintainers):

1. Clone template to temporary directory
2. Edit `.fulmen/app.yaml` with test identity (breed â†’ `testapp`)
3. Run `make validate-app-identity` â†’ SHOULD detect hardcoded references
4. Fix all violations
5. Run `make doctor` â†’ MUST pass
6. Run `make test` â†’ MUST pass
7. Run `make build && make run` â†’ MUST work with test identity

---

### 6. Repository Taxonomy Updates

**Existing Categories Enhanced**:

- `workhorse`: Added note "Templates (forge-workhorse-\*) must comply with CDRL standard" + references
- `codex`: Added note "Templates (forge-codex-\*) must comply with CDRL standard" + references

**Validation Script Updated**:

- `scripts/validate-schemas.ts`: Added `forge-workhorse`, `forge-codex`, `forge-gymnasium` to CATEGORY_KEYS set

---

## Impact on Users

### For Template Maintainers (Groningen, Percheron, Aurora)

**Immediate Actions**:

1. **Read CDRL Documentation**:
   - Architectural standard: `docs/architecture/fulmen-template-cdrl-standard.md`
   - Workflow guide: `docs/standards/cdrl/workflow-guide.md`
   - Makefile Annex B: `docs/standards/makefile-standard.md#annex-b`

2. **Create Required Documentation**:
   - Follow canonical outline for `docs/development/fulmen_cdrl_guide.md`
   - Add optional `tooling-guide.md` for goneat, hooks, DX choices
   - Update `docs/development/README.md` as entry point

3. **Implement Validation Targets**:
   - Add `make validate-app-identity` to Makefile
   - Add `make doctor` to Makefile
   - Document both in `make help` output

4. **Test CDRL Workflow**:
   - Perform example refit test per forge standards
   - Verify all validation targets pass

5. **Update Repository Category**:
   - Ensure templates are tagged as `forge-workhorse` or `forge-codex` in metadata

### For Template Users

**No Changes Required**: This is a Crucible SSOT update. Templates will adopt CDRL compliance incrementally.

**Future Benefits** (when templates adopt v0.2.8):

- Standardized customization workflow across all templates
- Automated validation prevents incomplete refit
- Comprehensive documentation with troubleshooting
- Predictable structure for finding information

### For Helper Library Maintainers

**No Changes Required**: Exit codes snapshot fix is internal to Crucible build process.

**Benefit**: Prevents future test failures from snapshot staleness.

---

## Breaking Changes

**None** - This release contains zero breaking changes:

- All changes are documentation and process improvements
- CDRL compliance is for forge templates, not helper libraries or applications
- Exit codes fix is internal build process enhancement
- Taxonomy additions are non-breaking

---

## Validation

**All quality gates passed**:

- âœ… Schema validation: Taxonomy + all schemas valid
- âœ… Version consistency: Taxonomy 0.2.8 = repository VERSION
- âœ… Exit code snapshot: Regenerated with correct signal descriptions
- âœ… CDRL documentation: Complete cross-linking verified
- âœ… SSOT sync: Documentation synced to Python + TypeScript wrappers
- âœ… Format: All files formatted (goneat + Biome)
- âœ… Lint: TypeScript, Python, Go, YAML all passed
- âœ… Tests: Go, TypeScript, Python - all passing
- âœ… Type check: TypeScript passed

---

## Migration

### Update Dependency

**Go**:

```bash
go get github.com/fulmenhq/crucible@v0.2.8
go mod tidy
```

**TypeScript/Bun**:

```bash
bun add @fulmenhq/crucible@latest
```

**Python**:

```bash
uv add crucible@latest
```

### No Code Changes Required

This documentation and process improvement release requires no code changes for existing applications or helper libraries.

**Template Adoption** (recommended for forge templates):

1. Update Crucible dependency to v0.2.8
2. Follow CDRL standard to add required documentation
3. Implement validation targets
4. Test CDRL workflow with example refit

---

## Files Added

**CDRL Documentation**:

- `docs/architecture/fulmen-template-cdrl-standard.md` - Architectural requirements (5,700+ words)
- `docs/standards/cdrl/workflow-guide.md` - User-facing step-by-step guide (4,800+ words)
- `docs/standards/cdrl/reference-bootstrap.md` - Bootstrap pattern implementation guide (18,000+ words)

**Release Documentation**:

- `release-notes/v0.2.8.md` - This file

---

## Files Changed

**Version Files**:

- `VERSION` (0.2.7 â†’ 0.2.8)
- `package.json` (root)
- `lang/python/pyproject.toml`
- `lang/typescript/package.json`

**Taxonomy**:

- `config/taxonomy/repository-categories.yaml` - Added 3 forge categories, enhanced workhorse/codex with CDRL references
- `config/taxonomy/metrics.yaml` - Version update (0.2.7 â†’ 0.2.8)
- Synced to `lang/python/` and `lang/typescript/`

**Documentation**:

- `docs/architecture/fulmen-template-cdrl-standard.md` - Added Bootstrap Script section (RECOMMENDED)
- `docs/architecture/fulmen-forge-workhorse-standard.md` - Added CDRL Compliance section with bootstrap requirements
- `docs/architecture/fulmen-forge-codex-standard.md` - Added CDRL Compliance section with bootstrap requirements
- `docs/architecture/sync-model.md` - Documented two-stage sync pipeline
- `docs/standards/cdrl/workflow-guide.md` - Enhanced Launch stage with bootstrap details
- `docs/standards/makefile-standard.md` - Added Annex B: Template Repository CDRL Targets
- All docs synced to `lang/python/` and `lang/typescript/`

**Scripts**:

- `scripts/sync-to-lang.ts` - Added snapshot generation in sync pipeline
- `scripts/validate-schemas.ts` - Added forge template categories to CATEGORY_KEYS

**Build Artifacts**:

- `config/library/foundry/exit-codes.snapshot.json` - Regenerated with correct descriptions
- Synced to language wrappers

**Makefile**:

- Added `generate-snapshots` target

**Changelog**:

- `CHANGELOG.md` - Updated with v0.2.8 entries

---

## Implementation Status

**v0.2.8 (This Release)**:

- âœ… CDRL architectural standard published
- âœ… CDRL workflow guide published
- âœ… Required documentation outline specified
- âœ… Makefile standard Annex B published
- âœ… Forge standards updated with CDRL compliance
- âœ… Three forge template categories added to taxonomy
- âœ… Exit codes snapshot staleness fixed
- âœ… Two-stage sync pipeline implemented

**Forge Templates (Next)**:

- ðŸ”œ groningen: Adopt CDRL v0.2.8 standard (add docs, validation targets)
- ðŸ”œ percheron: Adopt CDRL v0.2.8 standard (add docs, validation targets)
- ðŸ”œ aurora: Adopt CDRL v0.2.8 standard at launch

---

## Related

- [CHANGELOG](../CHANGELOG.md) - Full version history
- [CDRL Architectural Standard](../docs/architecture/fulmen-template-cdrl-standard.md) - Template requirements
- [CDRL Workflow Guide](../docs/standards/cdrl/workflow-guide.md) - User instructions
- [Makefile Standard](../docs/standards/makefile-standard.md) - Validation targets (Annex B)
- [Workhorse Standard](../docs/architecture/fulmen-forge-workhorse-standard.md) - Backend templates
- [Codex Standard](../docs/architecture/fulmen-forge-codex-standard.md) - Documentation templates
- [Repository Categories Taxonomy](../config/taxonomy/repository-categories.yaml) - Category definitions
- [Sync Model](../docs/architecture/sync-model.md) - Build pipeline architecture

---

## Credits

**Implementation**: Schema Cartographer (AI agent, supervised by @3leapsdave)
**Design**: Groningen CDRL prototype informed architectural decisions
**Review**: @3leapsdave
**Context**: Exit codes fix driven by tsfulmen test failures

---

For questions or issues, see the [CHANGELOG](../CHANGELOG.md) or open an issue on GitHub.
