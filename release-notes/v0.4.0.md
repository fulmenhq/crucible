# Crucible v0.4.0 Release Notes

**Release Date**: 2026-01-05
**Type**: Minor feature release

## Summary

This release introduces weight classification and feature gate support for helper library modules, enabling consistent feature gating across all language implementations (Rust, Go, Python, TypeScript). The similarity module is promoted from foundry-catalogs to a standalone platform module, and a new product marketing agentic role is added.

## Changes

### Added

#### Module Registry v1.1.0

New schema version for platform modules with weight classification and feature gate support:

**New Fields**:

| Field                  | Type               | Description                         |
| ---------------------- | ------------------ | ----------------------------------- |
| `weight`               | `light` \| `heavy` | Dependency footprint classification |
| `default_inclusion`    | boolean            | Whether included in default builds  |
| `notes` (per-language) | string             | Build-specific guidance             |

**Schema Location**: `schemas/taxonomy/library/modules/v1.1.0/module-entry.schema.json`

**Weight Classification Criteria**:

- **light**: Stdlib or serde-class dependencies only
- **heavy**: Significant dependency tree beyond serde-class

**Serde-Class Exemptions** (don't count toward "heavy"):

| Language   | Exempt Dependencies                                                     |
| ---------- | ----------------------------------------------------------------------- |
| Rust       | `serde`, `serde_json`, `serde_yaml`, `once_cell`, `thiserror`, `anyhow` |
| Python     | `pydantic`, `pyyaml`, stdlib                                            |
| TypeScript | `yaml`, native JSON                                                     |
| Go         | stdlib                                                                  |

**Why**: Helper libraries need consistent feature gating to avoid bloating default installs with heavy dependencies like `jsonschema`, `regex`, or `strsim`.

#### Foundry Catalog Registry v1.1.0

New schema version for foundry reference data catalogs:

**New Fields**:

| Field               | Type               | Description                  |
| ------------------- | ------------------ | ---------------------------- |
| `weight`            | `light` \| `heavy` | Dependency footprint         |
| `default_inclusion` | boolean            | Default build inclusion      |
| `feature_group`     | string             | Library feature gate mapping |

**Feature Groups**:

| Group              | Catalogs                                      | Typical Cargo Feature |
| ------------------ | --------------------------------------------- | --------------------- |
| `foundry-core`     | signals, exit-codes, countries, http-statuses | `foundry-core`        |
| `foundry-patterns` | patterns                                      | `foundry-patterns`    |
| `foundry-mime`     | mime-types                                    | `foundry-mime-types`  |

**Schema Location**: `schemas/taxonomy/library/foundry-catalogs/v1.1.0/catalog-entry.schema.json`

#### Similarity Module Promotion

Similarity has been promoted from a foundry catalog entry to a standalone platform module:

**Before** (v1.0.0):

- Listed in `config/taxonomy/library/foundry-catalogs/v1.0.0/catalogs.yaml`
- 7 catalog entries total

**After** (v1.1.0):

- Listed in `config/taxonomy/library/platform-modules/v1.1.0/modules.yaml`
- Foundry catalogs reduced to 6 entries
- Platform modules increased to 19 entries

**Why**: Similarity is a code module (algorithms like Levenshtein, Jaro-Winkler), not reference data. It has heavy dependencies in all languages (`strsim`, `rapidfuzz`, `@3leaps/string-metrics-wasm`) and benefits from being feature-gated as a standalone module.

#### Module Registry Standard

New documentation at `docs/standards/fulmen/module-registry.md`:

- Weight classification semantics and criteria
- Serde-class exemption lists per language
- Heavy trigger dependency lists per language
- Library feature gate mapping patterns:
  - Rust: Cargo features
  - Python: Extras (`pip install pyfulmen[schema]`)
  - TypeScript: Separate entry points
  - Go: Build tags or separate packages

#### Product Marketing Role

New agentic role for product marketing activities:

```yaml
slug: prodmktg
name: Product Marketing
category: marketing
```

**Scope**:

- User persona creation and journey mapping
- Product messaging, taglines, and value propositions
- Storytelling narratives for pitches, websites, and docs
- Branding guidelines, visual identity, and assets

**Schema Change**: Added `marketing` to the `category` enum in `role-prompt.schema.json`.

### Fixed

#### Schema $id Host

Corrected `$id` URLs from `https://fulmenhq.dev/schemas/...` to `https://schemas.fulmenhq.dev/...`:

- `schemas/taxonomy/library/modules/v1.1.0/module-entry.schema.json`
- `schemas/taxonomy/library/foundry-catalogs/v1.1.0/catalog-entry.schema.json`

**Why**: rsfulmen's offline schema resolver maps `schemas.fulmenhq.dev` (and `schemas.3leaps.dev`, `json-schema.org`) but not `fulmenhq.dev`. Incorrect host would break offline `$ref` resolution.

## Commits

```
6be7ca1 feat(registry): add weight classification and feature gate support
d6dd4c9 fix(schema): correct $id host to schemas.fulmenhq.dev
82b1011 feat(roles): add prodmktg role with marketing category
64ef685 chore: sync lang wrappers after $id fix
```

## Impact

### For rsfulmen

- Can implement Cargo feature gates using registry metadata
- `foundry-core`, `foundry-patterns`, `foundry-mime` feature groups defined
- Similarity available as standalone heavy module with feature gate
- Schema `$id` resolution works with offline resolver

### For Other Helper Libraries

- gofulmen: Reference for future feature flag implementation
- pyfulmen: Can use `weight`/`default_inclusion` to define extras
- tsfulmen: Can use metadata for separate entry point decisions

### Module Classifications

**Heavy modules (default: false)**:

- `schema` (jsonschema)
- `similarity` (strsim/rapidfuzz)
- `telemetry` (prometheus)
- `fulpack` (archive libraries)

**Heavy modules (default: true)**:

- `fulhash` (xxhash - fundamental for content addressing)

**Light modules (default: true)**:

- `config`, `logging`, `pathfinder`, `app-identity`, `foundry`, etc.

## Upgrade Notes

No breaking changes. All additions are backward compatible.

- v1.0.0 registries remain available for consumers not yet ready to adopt weight classification
- New fields have sensible defaults (`weight: light`, `default_inclusion: true`)

## Cross-References

- Feature Brief: `.plans/active/v0.4.0/module-registry-weight-and-feature-gates-feature-brief.md`
- Library Memo: `.plans/memos/libraries/20260105-feature-flag-and-library-update.md`
- Module Registry Standard: `docs/standards/fulmen/module-registry.md`
- Platform Modules: `config/taxonomy/library/platform-modules/v1.1.0/modules.yaml`
- Foundry Catalogs: `config/taxonomy/library/foundry-catalogs/v1.1.0/catalogs.yaml`
- Product Marketing Role: `config/agentic/roles/prodmktg.yaml`
