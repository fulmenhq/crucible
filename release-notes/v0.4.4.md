# Crucible v0.4.4 Release Notes

**Release Date**: 2026-01-08
**Type**: Minor release (signal resolution standard)

## Summary

This release standardizes ergonomic signal name resolution across all Fulmen helper libraries. The new interfaces enable CLI tools to accept flexible signal input (`SIGTERM`, `term`, `15`, `sigterm`) while maintaining strict catalog semantics internally.

Origin: rsfulmen memo 2026-01-08, with feedback incorporated from gofulmen.

## New Interfaces

### Signal Resolution API

Three new functions added to the Foundry interfaces standard:

| Function           | Purpose                             |
| ------------------ | ----------------------------------- |
| `resolveSignal`    | Normalize and lookup signal by name |
| `listSignalNames`  | Enumerate all signal names          |
| `matchSignalNames` | Glob pattern matching for discovery |

**Language-Idiomatic Signatures**:

```go
// Go
func ResolveSignal(name string) *Signal
func ListSignalNames() []string
func MatchSignalNames(pattern string) []string
```

```python
# Python
def resolve_signal(name: str) -> Signal | None
def list_signal_names() -> list[str]
def match_signal_names(pattern: str) -> list[str]
```

```typescript
// TypeScript
function resolveSignal(name: string): Signal | undefined;
function listSignalNames(): string[];
function matchSignalNames(pattern: string): string[];
```

```rust
// Rust
fn resolve_signal(name: &str) -> Option<&'static Signal>
fn list_signal_names() -> Vec<&'static str>
fn match_signal_names(pattern: &str) -> Vec<&'static str>
```

### Resolution Algorithm

`resolveSignal(name)` implements a 7-step resolution order:

1. **Trim** leading/trailing whitespace
2. **Empty check**: Return `null` if empty after trim
3. **Exact match**: Try exact catalog name match (e.g., `"SIGTERM"`)
4. **Numeric match**: If input is positive numeric string, lookup by `unix_number`
   - `"15"` → SIGTERM, `"2"` → SIGINT
   - Negative numbers not supported: `"-15"` → null
5. **Uppercase normalization**:
   - Uppercase the input
   - If starts with `"SIG"`: lookup by name
   - Else: prepend `"SIG"` and lookup (e.g., `"term"` → `"SIGTERM"`)
6. **ID fallback**: Lowercase and try `id` field lookup (e.g., `"hup"` → SIGHUP)
7. **Not found**: Return `null`

**Note**: Numeric detection (step 4) operates on trimmed input from step 1.

### Glob Matching

`matchSignalNames(pattern)` supports:

- `*` matches zero or more characters
- `?` matches exactly one character
- Case-insensitive matching
- No regex dependencies

**Examples**:

- `SIG*` → all signals
- `*USR*` → SIGUSR1, SIGUSR2
- `SIG???` → SIGINT, SIGHUP (3-char suffix)

## Test Fixtures

**File**: `config/library/foundry/signal-resolution-fixtures.yaml`

41 test cases organized by resolution step:

| Category         | Cases | Examples                              |
| ---------------- | ----- | ------------------------------------- |
| Exact match      | 3     | `SIGTERM`, `SIGINT`, `SIGHUP`         |
| Numeric match    | 5     | `15`, `2`, `9`, `"  15  "`            |
| Lowercase        | 2     | `sigterm`, `sigint`                   |
| No prefix        | 7     | `TERM`, `term`, `INT`, `KILL`         |
| Mixed case       | 3     | `SigTerm`, `Term`, `SigInt`           |
| Whitespace       | 3     | `"  SIGTERM  "`, `"\tterm\n"`         |
| ID fallback      | 6     | `hup`, `usr1`, `usr2`, `quit`, `pipe` |
| Negative numbers | 2     | `"-15"`, `"-1"` → null                |
| Unknown          | 3     | `SIGFOO`, `FOO`, `999` → null         |
| Empty            | 2     | `""`, `"   "` → null                  |
| Glob patterns    | 10    | `SIG*`, `*USR*`, `SIG???`, `sig*`     |

**Schema**: `schemas/library/foundry/v1.0.0/signal-resolution-fixtures.schema.json`

## Documentation Updates

### Foundry README (`docs/standards/library/foundry/README.md`)

New **Signals** section covering:

- **Catalog Overview**: Signal table with ID, unix_number, exit_code, default_behavior
- **Behaviors**: graceful_shutdown, graceful_shutdown_with_double_tap, reload_via_restart, immediate_exit, custom, observe_only
- **Platform Support**: Linux/macOS/FreeBSD (native) vs Windows (mapped/fallback)
- **Helper Library Integration**: Required functions, index recommendations
- **Resolution Algorithm**: Full 7-step specification
- **Glob Matching**: Pattern rules and examples
- **Windows Fallbacks**: HTTP endpoint hints for unsupported signals

### Foundry Interfaces (`docs/standards/library/foundry/interfaces.md`)

New **Signal Resolution** section with:

- Required API surface table
- Language-idiomatic signature table
- Resolution algorithm specification
- Implementation notes including `signalsByNumber` index recommendation
- Testing requirements referencing fixtures
- Deferred enhancement note for alias handling

## Implementation Notes

### Index Recommendation

Helper libraries SHOULD build a `signalsByNumber` index during catalog load:

```go
// gofulmen example
type Catalog struct {
    signalsByName   map[string]*SignalDefinition
    signalsByID     map[string]*SignalDefinition
    signalsByNumber map[int]*SignalDefinition  // NEW: for numeric resolution
}
```

Without this index, numeric resolution (step 4) requires linear scan.

### Non-Breaking Design

New functions complement existing strict lookups:

- `lookupSignal(name)` - exact catalog name match only (unchanged)
- `getSignalNumber(name)` - return unix_number (unchanged)
- `resolveSignal(name)` - NEW: ergonomic resolution with normalization

Do NOT modify existing functions.

## Files Changed

**New files**:

- `config/library/foundry/signal-resolution-fixtures.yaml`
- `schemas/library/foundry/v1.0.0/signal-resolution-fixtures.schema.json`
- `release-notes/v0.4.4.md`

**Modified files**:

- `docs/standards/library/foundry/README.md` - Added Signals section
- `docs/standards/library/foundry/interfaces.md` - Added Signal Resolution section
- `CHANGELOG.md` - v0.4.4 entry
- `RELEASE_NOTES.md` - v0.4.4 summary (purged v0.4.1)

**Synced to lang wrappers**:

- `lang/python/`, `lang/typescript/`, `lang/rust/` - All config, schemas, docs synced

## Impact

### For rsfulmen

Reference implementation. Update v0.1.2 feature brief to:

- Include numeric resolution at step 4
- Align test cases with published fixtures
- Implement `signalsByNumber` index

### For gofulmen

Add to `foundry/signals/catalog.go`:

```go
func (c *Catalog) ResolveSignal(name string) *SignalDefinition
func (c *Catalog) ListSignalNames() []string
func (c *Catalog) MatchSignalNames(pattern string) []string
```

Add `signalsByNumber` index during load (around line 124-130).

### For pyfulmen and tsfulmen

Implement resolution interfaces per language-idiomatic signatures.

### For All Helper Libraries

- Sync crucible v0.4.4 to get fixtures and updated docs
- Implement resolution interfaces
- Add fixture parity tests

## Upgrade Notes

1. This is a **non-breaking** minor release
2. New interfaces are additive - existing code unaffected
3. Sync crucible v0.4.4 to get fixtures for testing
4. Implement interfaces before v0.5.0 (will be required)

## Cross-References

- [rsfulmen memo](../.plans/memos/crucible/20260108-signal-name-resolution-standard.md)
- [Foundry Interfaces](../docs/standards/library/foundry/interfaces.md#signal-resolution)
- [Foundry README - Signals](../docs/standards/library/foundry/README.md#signals)
- [Signal Resolution Fixtures](../config/library/foundry/signal-resolution-fixtures.yaml)
- [v0.4.3 Release Notes](v0.4.3.md)
