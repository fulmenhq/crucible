# v0.4.6 - OpenAPI Spec Coverage Standard

**Release Date**: 2026-01-12

Establishes ecosystem-wide standards for OpenAPI specification verification, preventing spec drift across fixtures and workhorses.

## Highlights

- **ADR-0014**: New decision record for OpenAPI spec coverage testing
- **Tiered Requirements**: Fixtures MUST, Workhorses SHOULD, DX tools MAY
- **Coverage Testing**: Automated verification that specs cover all registered routes
- **Cross-Standard Integration**: Updates to fixture, workhorse, codex, and HTTP standards

## Added

### ADR-0014: OpenAPI Spec Coverage Tests

New architecture decision record at `docs/architecture/decisions/ADR-0014-openapi-spec-coverage.md`.

**Problem**: Spec drift occurs when developers add endpoints to routers without updating OpenAPI annotations. Generators produce partial specs, and consumers assume completeness.

**Solution**: Automated coverage test comparing registered routes against OpenAPI spec paths.

**Key Features**:

- **Tiered requirements by repository category**:
  | Category | OpenAPI Publication | Coverage Test | CI Enforcement |
  |----------|---------------------|---------------|----------------|
  | Fixtures | MUST | MUST | MUST |
  | Workhorses | SHOULD | SHOULD | SHOULD |
  | DX Tools | MAY | MAY | MAY |

- **Intentional exclusions**: Maintainers MAY exclude experimental, internal, or self-referential endpoints

- **CI workflow integration**: `make openapi` before `make test`

- **Format compatibility**: Supports both Swagger 2 (`swagger: "2.0"`) and OpenAPI 3 (`openapi: "3.x.x"`)

- **Release asset guidance**: Optional inclusion in `dist/release/` for signed artifacts

- **Provenance metadata**: Use `info.x-*` extensions (tooling-safe, no frontmatter pollution)

### OpenAPI Publication Section

Added to Fixture Standard (`docs/architecture/fulmen-fixture-standard.md`).

**Requirements**:

| Requirement   | Level | Details                                       |
| ------------- | ----- | --------------------------------------------- |
| Generation    | MUST  | `make openapi` produces `dist/openapi.yaml`   |
| Serving       | MUST  | `GET /openapi.yaml` returns the spec          |
| Coverage test | MUST  | CI verifies spec covers all registered routes |
| CI workflow   | MUST  | `make openapi` runs before `make test`        |

**Build artifact patterns** (both acceptable):

| Pattern        | Spec Location                    | Serving Mechanism    | Example  |
| -------------- | -------------------------------- | -------------------- | -------- |
| Build artifact | `dist/openapi.yaml`              | Read from filesystem | gauntlet |
| Embedded       | `internal/handlers/openapi.yaml` | `//go:embed`         | rampart  |

### OpenAPI Verification Section

Added to HTTP Server Patterns guide (`docs/guides/testing/http-server-patterns.md`).

- Spec drift problem explanation
- Coverage test Go implementation pattern
- CI integration snippet
- Intentional exclusions guidance
- Best practice: "going concern" endpoints SHOULD be documented

## Changed

### HTTP REST Standard

Added OpenAPI Documentation section (`docs/standards/protocol/http-rest-standards.md`):

- Servers exposing HTTP APIs SHOULD publish an OpenAPI specification
- Generator and serving recommendations
- Coverage testing reference to ADR-0014

### Workhorse Standard

Added `/openapi.yaml` endpoint and ADR-0014 reference (`docs/architecture/fulmen-forge-workhorse-standard.md`):

- SHOULD for workhorses exposing HTTP APIs
- Cross-link to HTTP Server Patterns guide

### Codex Standard

Added cross-link in Pillar III (`docs/architecture/fulmen-forge-codex-standard.md`):

- Upstream spec quality expectation for ingested OpenAPI specs
- Reference to ADR-0014 coverage testing standards

### Fixture Author Conformance Checklist

Added OpenAPI items to `docs/guides/testing/http-server-patterns.md`:

- [ ] OpenAPI spec generated and served at `/openapi.yaml`
- [ ] OpenAPI coverage test passes (all routes documented)

## Impact

### Fixture Maintainers

- Implement coverage tests per ADR-0014
- Ensure `make openapi` runs before `make test` in CI
- Document any intentional exclusions

### Workhorse Maintainers

- Consider OpenAPI publication for HTTP APIs
- Follow SHOULD guidance from ADR-0014

### gauntlet/rampart Teams

- Local ADR-0001 now superseded by Crucible ADR-0014
- Update repo documentation to reference ecosystem standard
- Coverage test implementations remain valid

## Files Changed

### New Files

- `docs/architecture/decisions/ADR-0014-openapi-spec-coverage.md`

### Modified Files

- `docs/architecture/fulmen-fixture-standard.md` - OpenAPI Publication section
- `docs/architecture/fulmen-forge-workhorse-standard.md` - `/openapi.yaml` reference
- `docs/architecture/fulmen-forge-codex-standard.md` - Pillar III cross-link
- `docs/guides/testing/http-server-patterns.md` - OpenAPI Verification section
- `docs/standards/protocol/http-rest-standards.md` - OpenAPI Documentation section

## Migration Guide

### For Existing Fixtures

1. Ensure `make openapi` target exists and produces `dist/openapi.yaml`
2. Ensure `GET /openapi.yaml` endpoint serves the spec
3. Implement coverage test (see ADR-0014 for pattern)
4. Update CI to run `make openapi` before `make test`
5. Document any intentional exclusions in test file

### For New Fixtures

Follow the Fixture Standard's OpenAPI Publication section from the start.

## Related Documentation

- [ADR-0014: OpenAPI Spec Coverage Tests](../docs/architecture/decisions/ADR-0014-openapi-spec-coverage.md)
- [Fulmen Fixture Standard](../docs/architecture/fulmen-fixture-standard.md)
- [HTTP Server Patterns Guide](../docs/guides/testing/http-server-patterns.md)
- [HTTP REST Standard](../docs/standards/protocol/http-rest-standards.md)
